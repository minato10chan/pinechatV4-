# 不動産情報チャットシステム

## プロジェクト概要
このプロジェクトは、特定の地域に関する情報を提供し、不動産の購入や賃貸の判断をサポートするチャットシステムです。物件情報や地域の生活情報を自然な会話形式で提供します。

## 機能概要
### チャット機能
- 自然言語での質問応答
- 物件情報の検索と表示
- 地域情報の提供
- 施設情報の検索
- チャット履歴の保存と管理

### 物件情報管理
- 物件情報の登録と更新
- 都道府県・市区町村ごとの管理
- 物件種別（一戸建て、土地、マンションなど）の管理
- 詳細な位置情報（緯度・経度、徒歩距離、直線距離）の管理

### データ管理
- テキストファイルのアップロードと処理
- CSVファイルのインポート
- 複数エンコーディング（UTF-8、Shift-JIS、CP932、EUC-JP）のサポート
- データの検証と前処理

### エージェントモード
- 質問の自動分類
- メタデータの検証とエラー処理
- コンテキストに基づく回答生成
- 回答の品質管理

## システム構成
### フロントエンド
- Streamlitを使用したWebインターフェース
- インタラクティブなチャットUI
- データ可視化（Pandas DataFrame）
- 設定管理インターフェース

### バックエンド
- Python
- LangChain（LLM統合）
- Pinecone（ベクトルデータベース）
- OpenAI GPT-3.5-turbo（言語モデル）
- Pandas（データ処理）

## ディレクトリ構成
```
src/
├── components/         # UIコンポーネント
│   ├── chat.py        # チャット機能
│   ├── settings.py    # 設定画面
│   ├── agent.py       # エージェント機能
│   ├── file_upload.py # ファイルアップロード
│   └── property_upload.py # 物件情報アップロード
├── services/          # バックエンドサービス
│   ├── langchain_service.py  # LangChain統合
│   ├── pinecone_service.py   # Pinecone操作
│   ├── question_classifier.py # 質問分類
│   ├── metadata_processor.py # メタデータ処理
│   └── response_templates.py # 回答テンプレート
├── config/            # 設定ファイル
│   └── settings.py    # 環境設定
└── pages/             # ページコンポーネント
    └── Home.py        # ホームページ
```

## 処理フロー
### チャット機能
1. ユーザー入力の受付
2. 質問の分類（物件、地域、施設）
3. 関連情報の検索
4. コンテキストの生成
5. 回答の生成
6. 履歴の保存

### データフロー
1. ファイルアップロード
2. テキストの前処理
3. チャンク分割
4. ベクトル化
5. Pineconeへの保存

## 設定オプション
### テキスト処理
- チャンクサイズ
- オーバーラップ
- エンコーディング設定

### 検索設定
- 類似度閾値
- 検索結果数
- 名前空間設定

### プロンプト設定
- システムプロンプト
- 応答テンプレート
- 質問タイプ別テンプレート

### データベース設定
- Pinecone接続情報
- インデックス設定
- バッチサイズ

## 使用方法
1. 環境設定
   - 必要なパッケージのインストール
   - 環境変数の設定
   - APIキーの設定

2. アプリケーション起動
   - Streamlitサーバーの起動
   - ブラウザでのアクセス

3. 機能の利用
   - チャット機能
   - ファイルアップロード
   - 設定の調整

## 改善計画
### 1. プロンプトエンジニアリングの改善
- システムプロンプトの最適化
  - より具体的な指示と制約の追加
  - 回答の形式と品質基準の明確化
  - エラー処理とフォールバックの定義
- テンプレートの拡充
  - 質問タイプごとの専用テンプレート追加
  - コンテキストの活用方法の改善
  - メタデータの活用方法の強化

### 2. コンテキスト検索の改善
- 検索アルゴリズムの最適化
  - 類似度閾値の動的調整
  - 複数クエリの組み合わせ
  - メタデータの重み付け
- 検索結果の後処理
  - 重複情報の除去
  - 情報の優先順位付け
  - コンテキストの要約

### 3. メタデータ処理の強化
- メタデータの拡充
  - より詳細な属性情報の追加
  - 時系列情報の活用
  - 信頼性スコアの導入
- メタデータの検証
  - データの整合性チェック
  - 欠損値の処理
  - 異常値の検出

### 4. エラーハンドリングの改善
- エラー検出の強化
  - より詳細なエラー分類
  - エラーの自動回復
  - ユーザーへの適切なフィードバック
- フォールバックメカニズム
  - 代替回答の準備
  - 段階的な機能低下
  - リカバリー手順の実装

### 5. パフォーマンス最適化
- キャッシュの導入
  - 頻出クエリのキャッシュ
  - 検索結果のキャッシュ
  - メタデータのキャッシュ
- バッチ処理の最適化
  - 並列処理の導入
  - リソース使用量の最適化
  - 処理時間の短縮

### 6. 追加機能の検討
- ユーザーフィードバックの活用
  - 回答の評価システム
  - フィードバックに基づく学習
  - ユーザー行動の分析
- マルチモーダル対応
  - 画像認識の追加
  - 音声入力のサポート
  - 地図情報の統合
- セキュリティ強化
  - 入力検証の強化
  - レート制限の実装
  - データ保護の強化

## 注意事項
- OpenAI APIキーとPinecone APIキーが必要です
- 大量のデータを処理する場合は、リソース設定に注意が必要です
- CSVファイルのエンコーディングに注意が必要です
- 位置情報は適切に管理する必要があります
- 物件情報はPineconeで管理されます

## ライセンス
このプロジェクトはMITライセンスの下で公開されています。
# 地域情報チャットシステム

このプロジェクトは、特定の地域の周辺情報を自然言語で検索・案内できるチャットシステムです。不動産購入や賃貸の意思決定を支援することを目的としており、物件情報だけでなく、その地域で生活する上で必要な様々な情報を提供します。

## 機能概要

### 1. チャット機能
- 自然言語での質問応答
- 物件情報の検索と表示
- チャット履歴の保存と読み込み
- カスタマイズ可能なプロンプトテンプレート
- 日本語の形態素解析による高度な処理
- 会話履歴のCSVエクスポート/インポート

### 2. 物件情報管理
- 物件情報の登録と管理
- 物件の詳細情報の表示
- 位置情報（緯度・経度）の管理
- 物件のカテゴリ分類
- 都道府県・市区町村による地域管理
- 物件種別（一戸建て、土地、マンション）の管理

### 3. データ管理
- テキストファイルのアップロード
- CSVファイルの一括処理
- メタデータの管理（カテゴリ、地域、日付など）
- チャット履歴のCSVエクスポート/インポート
- 複数エンコーディング対応（UTF-8, Shift-JIS, CP932, EUC-JP）
- 位置情報の管理（緯度・経度、徒歩距離、直線距離）

### 4. エージェントモード
- 質問の自動分類
- 関連情報の検索
- 構造化された回答の生成
- 思考プロセスの可視化
- メタデータの検証と処理
- エラーハンドリングとフィードバック

## システム構成

### フロントエンド
- Streamlit
  - チャットインターフェース
  - ファイルアップロード
  - 設定管理
  - エージェントモード
  - リアルタイム更新（watchdog）
  - データ可視化（Pandas DataFrame）

### バックエンド
- Python
  - LangChain（自然言語処理）
  - Pinecone（ベクトルデータベース）
  - OpenAI GPT-3.5-turbo（応答生成）
  - Janome（日本語形態素解析）
  - LangSmith（トレーシングとモニタリング）
  - Pandas（データ処理）

## ディレクトリ構造

```
.
├── src/                    # ソースコード
│   ├── components/         # UIコンポーネント
│   │   ├── chat.py        # チャット機能
│   │   ├── file_upload.py # ファイルアップロード
│   │   ├── settings.py    # 設定管理
│   │   └── agent.py       # エージェント機能
│   ├── services/          # ビジネスロジック
│   │   ├── langchain_service.py    # LangChain処理
│   │   ├── pinecone_service.py     # Pinecone操作
│   │   └── question_classifier.py  # 質問分類
│   └── config/            # 設定ファイル
│       └── settings.py    # システム設定
├── templates/             # テンプレートファイル
├── tests/                # テストコード
├── .streamlit/           # Streamlit設定
├── .env                  # 環境変数
├── .env.template         # 環境変数テンプレート
├── requirements.txt      # 依存パッケージ
└── streamlit_app.py      # メインアプリケーション
```

## 処理フロー

### チャット機能
1. ユーザー入力
2. 入力処理（テキストの前処理、質問の分類）
3. コンテキスト検索（Pineconeでの類似文書検索）
4. 応答生成（GPT-3.5-turbo）
5. 応答処理（フォーマット整形、詳細情報の付加）
6. 履歴管理（メッセージの保存、セッション状態の更新）

### データフロー
1. ユーザー入力
2. Pinecone検索（ベクトル化、類似度検索）
3. コンテキスト構築（関連文書の抽出、メタデータの統合）
4. GPT-3.5-turbo処理（プロンプトの構築、応答の生成）
5. 結果の整形（フォーマット適用、詳細情報の付加）
6. UI表示（メッセージの表示、詳細情報の展開）

## 設定項目

### テキスト処理設定
- チャンクサイズ（文字数）
- バッチサイズ
- 日本語形態素解析の設定
- エンコーディング設定

### 検索設定
- 検索結果数
- 類似度しきい値
- Pineconeインデックス設定
- ネームスペース設定

### プロンプト設定
- システムプロンプト
- レスポンステンプレート
- カスタムプロンプトテンプレート
- 質問タイプ別テンプレート

### データベース設定
- Pinecone接続情報
- インデックス設定
- ネームスペース設定
- メタデータスキーマ設定

## 使用方法

1. 環境設定
   ```bash
   # リポジトリのクローン
   git clone [repository-url]
   cd [repository-name]

   # 依存パッケージのインストール
   pip install -r requirements.txt

   # 環境変数の設定
   cp .env.template .env
   # .envファイルを編集して必要なAPIキーを設定
   ```

2. アプリケーションの起動
   ```bash
   streamlit run streamlit_app.py
   ```

3. 機能の利用
   - チャット機能：自然言語での質問応答
   - ファイルアップロード：テキストファイルやCSVファイルの登録
   - 設定管理：システム設定のカスタマイズ
   - エージェントモード：高度な質問応答機能

## 開発環境

- Python 3.8以上
- Streamlit
- Pinecone 3.0.0以上
- OpenAI API 1.0.0以上
- LangChain 0.1.0以上
- Janome 0.5.0（日本語形態素解析）
- LangSmith 0.0.69以上（トレーシングとモニタリング）
- Pandas（データ処理）

## 注意事項

- OpenAI APIキーが必要です
- Pinecone APIキーが必要です
- 大量のデータを処理する場合は、適切なリソース設定が必要です
- 日本語の形態素解析にはJanomeを使用しています
- LangSmithを使用したトレーシングとモニタリングが可能です
- CSVファイルのアップロード時は、適切なエンコーディングを選択してください
- 位置情報は緯度・経度の形式で管理されます
- 物件情報はPineconeのpropertyネームスペースで管理されます

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。